!function(t){var e={};function n(i){if(e[i])return e[i].exports;var a=e[i]={i:i,l:!1,exports:{}};return t[i].call(a.exports,a,a.exports,n),a.l=!0,a.exports}n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)n.d(i,a,function(e){return t[e]}.bind(null,a));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=0)}([function(t,e,n){n(1),t.exports=n(3)},function(t,e,n){(function(i){var a,c,o;o=void 0!==i?i:this.window||this.global,a=function(t){"use strict";new DOMParser;var e,n,i,a,c,o=!1;const r={punchListItems:"punch-items",punchListItem:"punch-item-",punchListItemText:"punch-item-text-",punchListComments:"punch-comments-",punchListComment:"punch-comment-",punchListCommentText:"punch-comment-text-",punchListProjects:"punch-projects",punchListWorking:"punch-working",punchListModal:"punch-modal",punchListModalTitle:"punch-modal-title",punchListModalText:"punch-modal-text",punchListModalActionOk:"punch-modal-action-ok",punchListModalActionCancel:"punch-modal-action-cancel",punchListCommentCount:"punchlist-comment-count-"},s={punchListLoading:'<div class="punchlist-loader"></div>',punchlistProjectTemplate:({id:t,name:e,selected:n})=>`<option value="${t}" ${n}>${e}</option>`,punchListContainerTemplate:({title:t,projects:e})=>`\n    <div id="${r.punchListWorking}" class="punchlist-working hidden">\n      <div class="punchlist-modal hidden" id="${r.punchListModal}">\n        <div class="title" id="${r.punchListModalTitle}">Confirm</div>\n        <div class="text" id="${r.punchListModalText}"></div>\n        <div class="actions">\n          <button id="${r.punchListModalActionOk}" class="button confirm">Confirm</button>\n          <button id="${r.punchListModalActionCancel}" class="button cancel">Cancel</button>\n        </div>\n      </div>\n    </div>\n    <div class="punchlist-title">\n    <h1><i class="fa fa-check"></i>${t}</h1>\n    </div>\n    <div class="punchlist-projects"> Project: \n    <select id="${r.punchListProjects}">\n      ${e?e.map(s.punchlistProjectTemplate).join(""):'<option value="-1">No Projects</option>'}\n    </select>\n    </div>        \n    <div class="punchlist-items-container">\n    <div id="${r.punchListItems}" class="punchlist-items"></div>\n    <div class="punchlist-item-action-add" data-action="punchlist-item-action-add">\n      <i class="fa fa-plus"></i>\n      Add an Item\n    </div>        \n    </div>\n    <a id="punchListExportData" style="display:none"></a>`,punchListCommentTagsTemplate:t=>`<b>${t.name}</b>: ${t.value}`,punchListCommentTemplate:t=>`<div class="punchlist-comment" id="${r.punchListComment+t.id}" data-id="${t.id}">\n    <div class="punchlist-comment-text" id="${r.punchListCommentText+t.id}">${t.comment}</div>\n    <div class="punchlist-comment-tag">${t.tags?t.tags.map(s.punchListCommentTagsTemplate).join(" - "):""}${t.deletable?'<i class="fa fa-times-circle punchlist-item-comment-action-remove" data-action="punchlist-item-comment-action-remove" data-id="'+t.id+'"></i>':""}</div>\n    </div>`,punchListItemTagsTemplate:t=>`<div class="punchlist-item-tag"><b>${t.name}</b>: ${t.value}</div>`,punchListItemTemplate:t=>`\n    <div class="punchlist-item-container" id="${r.punchListItem+t.id}" data-id="${t.id}">\n      <input type="checkbox" id="check-punch-item-${t.id}" ${t.punched?"checked":""} data-id="${t.id}" data-action="punchlist-item-action-checked"/>    \n      <div class="punchlist-item">\n        <div class="punchlist-item-label">\n          <label for="check-punch-item-${t.id}" class="punchlist-item-label-text">\n            <i class="fa fa-check"></i> \n            <span class="punchlist-item-label-text-line">\n              <span class="punchlist-item-label-text-data" id="${r.punchListItemText+t.id}">\n              ${t.task}\n              </span>\n            </span>\n          </label>\n        </div>\n        <div class="punchlist-item-action" title="edit" data-action="punchlist-item-action-edit" data-id="${t.id}">\n          <i class="fas fa-pen punchlist-item-action-edit" data-action="punchlist-item-action-edit" data-id="${t.id}"></i>\n        </div>\n        <div class="punchlist-item-action comment" title="comments" data-action="punchlist-item-action-comment" data-id="${t.id}">\n          <div class="fa-stack fa-xs" data-action="punchlist-item-action-comment" data-id="${t.id}">\n            <i class="fa fa-comment fa-stack-2x punchlist-item-action-comment"></i>\n            <span class="fa fa-stack-1x fa-inverse" data-action="punchlist-item-action-comment" id="${r.punchListCommentCount+t.id}" data-id="${t.id}">${t.comments?t.comments.length:"0"}</span>\n          </div>\n        </div>\n        <div class="punchlist-item-action" title="remove" data-action="punchlist-item-action-remove" data-id="${t.id}">\n          <i class="fa fa-times-circle punchlist-item-action-remove" data-action="punchlist-item-action-remove" data-id="${t.id}"></i>\n        </div>\n      </div>\n      <div class="punchlist-item-tags">\n        ${t.tags?t.tags.map(s.punchListItemTagsTemplate).join(""):""}\n      </div>\n      <div class="punch-list-comments hidden" id="${r.punchListComments+t.id}">\n        ${t.comments?t.comments.map(s.punchListCommentTemplate).join(""):""}\n      </div>\n      <div class="punchlist-item-comment-action-add" data-id="${t.id}" data-action="punchlist-item-comment-action-add">\n        <i class="fa fa-plus"></i> Add Comment\n      </div>\n    </div>`};var l,u=window.punchList={},d=!!document.querySelector&&!!t.addEventListener,m={title:"Punch List",width:null,projectAPICall:null,itemAPICall:null,commentAPICall:null,projects:null,userId:1,projectId:null,confirmCheck:!0,confirmDeleteItem:!0,confirmDeleteComment:!0},p=function(){o=!0,a.classList.remove("hidden")},h=function(){o=!1,a.classList.add("hidden")},f=function(t,e,n){var i=c.querySelector("#"+r.punchListModalText),a=c.querySelector("#"+r.punchListModalActionOk),o=c.querySelector("#"+r.punchListModalActionCancel);i.innerHTML=t,c.classList.remove("hidden"),p(),a.onclick=function(){c.classList.add("hidden"),h(),e&&e()},o.onclick=function(){c.classList.add("hidden"),h(),n&&n()}},v=function(t){var e=i.querySelector("#"+r.punchListComments+t),n=i.querySelector("#"+r.punchListCommentCount+t),a=e.querySelectorAll(".punchlist-comment").length;n.innerHTML=a},L=function(){if(l.projectAPICall){var t=n.querySelector("#"+r.punchListProjects);i.innerHTML=s.punchListLoading,e=t.value,p(),Utils.apiCall("GET",l.projectAPICall+"/"+e,null,function(e){var n=g(e.items);u.drawItems(n),t.disabled=!1,h()},function(e){console.error(e),u.drawItems([]),t.disabled=!1,h()},l.apiToken)}},g=function(t){var e=[];for(var n of t)e.push(b(n));return e},b=function(t){var e={};e.id=t.id,e.task=t.title,e.tags=[{name:"User",value:t.user.name},{name:"Company",value:t.user.company},{name:"Date",value:new Date(t.created_at).toLocaleString()}],e.punched=t.punched;var n=[];if(t.comments)for(var i of t.comments)n.push(T(i));return e.comments=n,e},T=function(t){var e={};return e.id=t.id,e.comment=t.text,t.user.id==l.userId&&(e.deletable=!0),e.tags=[{name:"User",value:t.user.name},{name:"Company",value:t.user.company},{name:"Date",value:new Date(t.created_at).toLocaleString()}],e},y=function(t){var e=t.offsetHeight,n=t.animate([{height:e+"px"},{height:"0px"}],{duration:300});n.onfinish=function(e){t.remove()}},C=function(t,e,n){var i=document.createElement("textarea");return i.id=t,i.spellcheck=!0,e&&(i.value=e),n&&i.setAttribute("maxlength",n),i.style.width="100%",i.addEventListener("keydown",M,!1),autosize(i),i},w=function(t){var n=i.querySelector("#"+r.punchListItem+"new"),a=i,c=t.value;if(c.length>0)if(l.itemAPICall){p();var o={title:c,user_id:l.userId,project_id:e,punched:!1};Utils.apiCall("POST",l.itemAPICall,o,function(t){var e=b(t),i=Utils.map([e],s.punchListItemTemplate).join("");n.remove(),a.innerHTML=a.innerHTML+i,h()},function(t){n.remove(),console.error(t),h()},l.apiToken)}else{var u=new Date,t=[{id:u.getTime(),task:c,comments:[],tags:[],data:[]}],d=Utils.map(t,s.punchListItemTemplate).join("");n.remove(),a.innerHTML=a.innerHTML+d}else n.remove()},k=function(t){p();var e=t.getAttribute("data-id"),i=n.querySelector("#"+r.punchListItemText+e);if(l.itemAPICall){var a={title:t.value};Utils.apiCall("PUT",l.itemAPICall+"/"+e,a,function(t){var e=b(t);i.innerHTML=e.task,h()},function(e){console.error(e),i.innerHTML=t.getAttribute("data-old"),h()},l.apiToken)}else i.innerHTML=t.value},j=function(t){var e=t.getAttribute("data-id"),n=i.querySelector("#"+r.punchListComment+"new"),a=t.value;if(a.length>0)if(l.commentAPICall){p();var c={text:a,user_id:l.userId,item_id:e};Utils.apiCall("POST",l.commentAPICall,c,function(t){var a=T(t),c=i.querySelector("#"+r.punchListComments+e),o=Utils.map([a],s.punchListCommentTemplate).join("");n.remove(),c.innerHTML=o+c.innerHTML,h(),v(e)},function(t){n.remove(),console.error(t),h()},l.apiToken)}else t.parentNode.innerHTML=a,v(e);else n.remove()},A=function(t){if(!o){var e=t.target.getAttribute("data-action");switch(e){case"punchlist-item-action-checked":!function(t){var e=t.getAttribute("data-id"),n=function(){};l.itemAPICall&&(n=function(){var n={punched:t.checked};Utils.apiCall("PUT",l.itemAPICall+"/"+e,n,function(e){var n=b(e);t.checked=n.punched,h()},function(e){console.error(e),t.checked=!t.checked,h()},l.apiToken)}),l.confirmCheck?f("Do you want to change task status?",n,function(){t.checked=!t.checked}):n()}(t.target);break;case"punchlist-item-action-comment":a=t.target,c=a.getAttribute("data-id"),i.querySelector("#"+r.punchListComments+c).classList.toggle("hidden");break;case"punchlist-item-action-remove":!function(t){var e=t.getAttribute("data-id"),n=i.querySelector("#"+r.punchListItem+e),a=function(){y(n)};l.itemAPICall&&(a=function(){p(),Utils.apiCall("DELETE",l.itemAPICall+"/"+e,null,function(t){h(),y(n)},function(t){console.error(t),h()},l.apiToken)}),l.confirmDeleteItem?f("Do you want to remove task?",a,null):a()}(t.target);break;case"punchlist-item-action-add":!function(){var t=[{id:"new",task:"",comments:[],tags:[],data:[]}],e=Utils.map(t,s.punchListItemTemplate).join("");i.innerHTML=i.innerHTML+e;var n=i.querySelector("#"+r.punchListItem+"new").querySelector("#"+r.punchListItemText+"new"),a=C("punch-item-text-input");a.addEventListener("blur",I,!1),n.append(a),a.focus()}();break;case"punchlist-item-action-edit":!function(t){var e=t.getAttribute("data-id"),i=n.querySelector("#"+r.punchListItemText+e),a=i.innerHTML.trim(),c=C("punch-item-edit-input",a,255);c.setAttribute("data-id",e),c.addEventListener("blur",I,!1),c.setAttribute("data-old",a),i.innerHTML="",i.append(c),c.focus()}(t.target);break;case"punchlist-item-comment-action-add":!function(t){var e=t.getAttribute("data-id"),n=i.querySelector("#"+r.punchListComments+e),a={id:"new",comment:"",tags:[]},c=Utils.map([a],s.punchListCommentTemplate).join("");n.innerHTML=c+n.innerHTML;var o=C("punch-comment-input-text");o.setAttribute("data-id",e),n.querySelector("#"+r.punchListCommentText+"new").append(o),o.addEventListener("blur",I,!1),o.focus()}(t.target);break;case"punchlist-item-comment-action-remove":!function(t){var e=t.getAttribute("data-id"),n=i.querySelector("#"+r.punchListComment+e),a=n.closest(".punchlist-item-container").getAttribute("data-id"),c=function(){n.remove(),v(a)};l.commentAPICall&&(c=function(){p(),Utils.apiCall("DELETE",l.commentAPICall+"/"+e,null,function(t){n.remove(),v(a),h()},function(t){console.error(t),h()},l.apiToken)}),l.confirmDeleteComment?f("Do you want to remove this comment?",c,null):c()}(t.target)}}var a,c},I=function(t){if(!o){var e=t.target.getAttribute("id");switch(e){case"punch-item-text-input":w(t.target);break;case"punch-comment-input-text":j(t.target);break;case"punch-item-edit-input":k(t.target)}}},x=function(t){if(!o){var e=t.target.getAttribute("id");switch(e){case"punch-projects":L()}}},M=function(t){var e=t.which||t.keyCode;if(13===e){var i=t.target.getAttribute("id");switch(i){case"punch-item-text-input":t.target.disabled=!0,t.target.removeEventListener("blur",I,!1),w(t.target);break;case"punch-comment-input-text":t.target.disabled=!0,t.target.removeEventListener("blur",I,!1),j(t.target);break;case"punch-item-edit-input":t.target.removeEventListener("blur",I,!1),t.target.disabled=!0,k(t.target)}}else if(27===e){var i=t.target.getAttribute("id");"punch-item-edit-input"==i&&(t.target.removeEventListener("blur",I,!1),t.target.disabled=!0,function(t){var e=t.getAttribute("data-id");n.querySelector("#"+r.punchListItemText+e).innerHTML=t.getAttribute("data-old")}(t.target))}};return u.destroy=function(){l&&(n.removeEventListener("click",A,!1),n.removeEventListener("change",x,!0),l=null)},u.init=function(t){if(!d)return;u.destroy(),l=Utils.extend(m,t);let e=document.querySelector(l.container);e?(function(t){var e=l.projects.map(function(t){var e=Object.assign({},t);return e.id==l.projectId?e.selected="selected":e.selected="",e});t.classList.add("punchlist-container");var n=[{title:l.title,projects:e}].map(s.punchListContainerTemplate).join("");l.width&&(t.style.width=l.width+"px"),t.innerHTML=n}(n=e),i=n.querySelector("#"+r.punchListItems),n.addEventListener("click",A,!1),n.addEventListener("change",x,!0),a=n.querySelector("#"+r.punchListWorking),c=n.querySelector("#"+r.punchListModal),L()):(console.error('[PunchList][init] Main container not found. Selector: "'+l.container+'"'),u.destroy())},u.drawItems=function(t){if(t.length>0){var e=t.map(s.punchListItemTemplate).join("");i.innerHTML=e}else i.innerHTML=""},u.export=function(){if(l&&l.projectAPICall){var t=n.querySelector("#"+r.punchListProjects);e=t.value,p(),Utils.apiCall("GET",l.projectAPICall+"/"+e,null,function(t){var e="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(t)),n=document.getElementById("punchListExportData");n.setAttribute("href",e),n.setAttribute("download","punchlist.json"),n.click(),h()},function(t){console.error(t),h()},l.apiToken)}},u}(o),void 0===(c="function"==typeof a?a.call(e,n,e,t):a)||(t.exports=c)}).call(this,n(2))},function(t,e){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(t){"object"==typeof window&&(n=window)}t.exports=n},function(t,e){!function(){var t=window.DomReady={},e=navigator.userAgent.toLowerCase(),n={version:(e.match(/.+(?:rv|it|ra|ie)[\/: ]([\d.]+)/)||[])[1],safari:/webkit/.test(e),opera:/opera/.test(e),msie:/msie/.test(e)&&!/opera/.test(e),mozilla:/mozilla/.test(e)&&!/(compatible|webkit)/.test(e)},i=!1,a=!1,c=[];function o(){if(!a&&(a=!0,c)){for(var t=0;t<c.length;t++)c[t].call(window,[]);c=[]}}function r(){if(!i){var t,e,c;if(i=!0,document.addEventListener&&!n.opera&&document.addEventListener("DOMContentLoaded",o,!1),n.msie&&window==top&&function(){if(!a){try{document.documentElement.doScroll("left")}catch(t){return void setTimeout(arguments.callee,0)}o()}}(),n.opera&&document.addEventListener("DOMContentLoaded",function(){if(!a){for(var t=0;t<document.styleSheets.length;t++)if(document.styleSheets[t].disabled)return void setTimeout(arguments.callee,0);o()}},!1),n.safari)!function(){if(!a)if("loaded"==document.readyState||"complete"==document.readyState){if(void 0===t){for(var e=document.getElementsByTagName("link"),n=0;n<e.length;n++)"stylesheet"==e[n].getAttribute("rel")&&t++;var i=document.getElementsByTagName("style");t+=i.length}document.styleSheets.length==t?o():setTimeout(arguments.callee,0)}else setTimeout(arguments.callee,0)}();e=o,c=window.onload,"function"!=typeof window.onload?window.onload=e:window.onload=function(){c&&c(),e()}}}t.ready=function(t,e){r(),a?t.call(window,[]):c.push(function(){return t.call(window,[])})},r()}();window.Utils={map:function(t,e){var n;if(Array.isArray(t))n=t.map(e);else if("object"==typeof t&&t)for(var i in n=[],t)n.push(e(t[i],i,t));return n},mapWithIndex:function(t,e,n){var i;return"object"==typeof e&&e&&(i=[]).push(n(e,t,e)),i},extend:function(){var t={},e=!1,n=0,i=arguments.length;"[object Boolean]"===Object.prototype.toString.call(arguments[0])&&(e=arguments[0],n++);for(var a=function(n){for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e&&"[object Object]"===Object.prototype.toString.call(n[i])?t[i]=extend(!0,t[i],n[i]):t[i]=n[i])};n<i;n++)a(arguments[n]);return t},apiCall:function(t,e,n,i,a,c){const o=new Headers;var r,s;o.append("Content-Type","application/json"),o.append("Authorization","Bearer "+c),o.append("Accept","application/json, text-plain, */*"),o.append("X-Requested-With","XMLHttpRequest");var l={method:t,mode:"cors",cache:"no-cache",credentials:"same-origin",headers:o,redirect:"follow",referrer:"no-referrer"};return"GET"!=t&&n&&(l.body=JSON.stringify(n)),fetch(e,l).then(t=>(r=t.status,s=t.ok,t.json())).then(t=>{if(!s){var e=new Error("Punch List Error");throw e.code=r,e.json=t,e}i(t)}).catch(t=>{if(!t.json)throw t;information=t.json,a(information)})}}}]);