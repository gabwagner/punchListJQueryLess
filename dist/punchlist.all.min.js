!function(t){var e={};function n(i){if(e[i])return e[i].exports;var c=e[i]={i:i,l:!1,exports:{}};return t[i].call(c.exports,c,c.exports,n),c.l=!0,c.exports}n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var c in t)n.d(i,c,function(e){return t[e]}.bind(null,c));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=0)}([function(t,e,n){n(1),t.exports=n(3)},function(t,e,n){(function(i){var c,a,o;o=void 0!==i?i:this.window||this.global,c=function(t){"use strict";new DOMParser;var e,n,i,c,a,o=!1;const s={punchListItems:"punch-items",punchListItem:"punch-item-",punchListItemText:"punch-item-text-",punchListComments:"punch-comments-",punchListComment:"punch-comment-",punchListCommentText:"punch-comment-text-",punchListProjects:"punch-projects",punchListWorking:"punch-working",punchListModal:"punch-modal",punchListModalTitle:"punch-modal-title",punchListModalText:"punch-modal-text",punchListModalActionOk:"punch-modal-action-ok",punchListModalActionCancel:"punch-modal-action-cancel",punchListCommentCount:"punchlist-comment-count-"},r={punchListLoading:'<div class="punchlist-loader"></div>',punchlistProjectTemplate:({id:t,name:e,selected:n})=>`<option value="${t}" ${n}>${e}</option>`,punchListContainerTemplate:({title:t,projects:e})=>`\n    <div id="${s.punchListWorking}" class="punchlist-working hidden">\n      <div class="punchlist-modal hidden" id="${s.punchListModal}">\n        <div class="title" id="${s.punchListModalTitle}">Confirm</div>\n        <div class="text" id="${s.punchListModalText}"></div>\n        <div class="actions">\n          <button id="${s.punchListModalActionOk}" class="button confirm">Confirm</button>\n          <button id="${s.punchListModalActionCancel}" class="button cancel">Cancel</button>\n        </div>\n      </div>\n    </div>\n    <div class="punchlist-title">\n    <h1><i class="fa fa-check"></i>${t}</h1>\n    </div>\n    <div class="punchlist-projects"> Project: \n    <select id="${s.punchListProjects}">\n      ${e?e.map(r.punchlistProjectTemplate).join(""):'<option value="-1">No Projects</option>'}\n    </select>\n    </div>        \n    <div class="punchlist-items-container">\n    <div id="${s.punchListItems}" class="punchlist-items"></div>\n    <div class="punchlist-item-action-add" data-action="punchlist-item-action-add">\n      <i class="fa fa-plus"></i>\n      Add an Item\n    </div>        \n    </div>`,punchListCommentTagsTemplate:t=>`<b>${t.name}</b>: ${t.value}`,punchListCommentTemplate:t=>`<div class="punchlist-comment" id="${s.punchListComment+t.id}" data-id="${t.id}">\n    <div class="punchlist-comment-text" id="${s.punchListCommentText+t.id}">${t.comment}</div>\n    <div class="punchlist-comment-tag">${t.tags?t.tags.map(r.punchListCommentTagsTemplate).join(" - "):""}${t.deletable?'<i class="fa fa-times-circle punchlist-item-comment-action-remove" data-action="punchlist-item-comment-action-remove" data-id="'+t.id+'"></i>':""}</div>\n    </div>`,punchListItemTagsTemplate:t=>`<div class="punchlist-item-tag"><b>${t.name}</b>: ${t.value}</div>`,punchListItemTemplate:t=>`<div class="punchlist-item-container" id="${s.punchListItem+t.id}" data-id="${t.id}">\n    <div class="punchlist-item">\n    <div class="punchlist-item-label">\n    <input type="checkbox" id="check-punch-item-${t.id}" ${t.punched?"checked":""} data-id="${t.id}" data-action="punchlist-item-action-checked"/>\n    <label for="check-punch-item-${t.id}" class="punchlist-item-label-text">\n    <i class="fa fa-check"></i> \n    <span class="punchlist-item-label-text-line">\n    <span class="punchlist-item-label-text-data" id="${s.punchListItemText+t.id}">${t.task}</span>\n    </span>\n    </label>\n    </div>\n    <div class="punchlist-item-action comment" title="comments" data-action="punchlist-item-action-comment" data-id="${t.id}">\n    <div class="fa-stack fa-xs" data-action="punchlist-item-action-comment" data-id="${t.id}">\n    <i class="fa fa-comment fa-stack-2x punchlist-item-action-comment"></i>\n    <span class="fa fa-stack-1x fa-inverse" data-action="punchlist-item-action-comment" id="${s.punchListCommentCount+t.id}" data-id="${t.id}">${t.comments?t.comments.length:"0"}</span>\n    </div>\n    </div>\n    <div class="punchlist-item-action" title="remove" data-action="punchlist-item-action-remove" data-id="${t.id}">\n    <i class="fa fa-times-circle punchlist-item-action-remove" data-action="punchlist-item-action-remove" data-id="${t.id}"></i>\n    </div>\n    </div>\n    <div class="punchlist-item-tags">\n    ${t.tags?t.tags.map(r.punchListItemTagsTemplate).join(""):""}\n    </div>\n    <div class="punch-list-comments hidden" id="${s.punchListComments+t.id}">\n    ${t.comments?t.comments.map(r.punchListCommentTemplate).join(""):""}\n    </div>\n    <div class="punchlist-item-comment-action-add" data-id="${t.id}" data-action="punchlist-item-comment-action-add">\n    <i class="fa fa-plus"></i>\n    Add Comment\n    </div>\n    </div>`};var l,u=window.punchList={},d=!!document.querySelector&&!!t.addEventListener,m={title:"Punch List",width:null,projectAPICall:null,itemAPICall:null,commentAPICall:null,projects:null,userId:1,projectId:null,confirmCheck:!0,confirmUnCheck:!0,confirmDeleteItem:!0},p=function(){o=!0,c.classList.remove("hidden")},h=function(){o=!1,c.classList.add("hidden")},f=function(t,e,n){var i=a.querySelector("#"+s.punchListModalText),c=a.querySelector("#"+s.punchListModalActionOk),o=a.querySelector("#"+s.punchListModalActionCancel);i.innerHTML=t,a.classList.remove("hidden"),p(),c.onclick=function(){a.classList.add("hidden"),h(),e&&e()},o.onclick=function(){a.classList.add("hidden"),h(),n&&n()}},v=function(t){var e=i.querySelector("#"+s.punchListComments+t),n=i.querySelector("#"+s.punchListCommentCount+t),c=e.querySelectorAll(".punchlist-comment").length;n.innerHTML=c},L=function(){if(l.projectAPICall){var t=n.querySelector("#"+s.punchListProjects);i.innerHTML=r.punchListLoading,e=t.value,p(),Utils.apiCall("GET",l.projectAPICall+"/"+e,null,function(e){var n=g(e.items);u.drawItems(n),t.disabled=!1,h()},function(e){console.error(e),u.drawItems([]),t.disabled=!1,h()},l.apiToken)}},g=function(t){var e=[];for(var n of t)e.push(y(n));return e},y=function(t){var e={};e.id=t.id,e.task=t.title,e.tags=[{name:"User",value:t.user.name},{name:"Company",value:t.user.company},{name:"Date",value:new Date(t.created_at).toLocaleString()}],e.punched=t.punched;var n=[];if(t.comments)for(var i of t.comments)n.push(b(i));return e.comments=n,e},b=function(t){var e={};return e.id=t.id,e.comment=t.text,t.user.id==l.userId&&(e.deletable=!0),e.tags=[{name:"User",value:t.user.name},{name:"Company",value:t.user.company},{name:"Date",value:new Date(t.created_at).toLocaleString()}],e},T=function(t){var e=t.offsetHeight,n=t.animate([{height:e+"px"},{height:"0px"}],{duration:300});n.onfinish=function(e){t.remove()}},w=function(t){var e=document.createElement("input");return e.type="text",e.id=t,e.style.width="100%",e},C=function(t){var n=i.querySelector("#"+s.punchListItem+"new"),c=i,a=t.value;if(a.length>0)if(l.itemAPICall){p();var o={title:a,user_id:l.userId,project_id:e,punched:!1};Utils.apiCall("POST",l.itemAPICall,o,function(t){var e=y(t),i=Utils.map([e],r.punchListItemTemplate).join("");n.remove(),c.innerHTML=c.innerHTML+i,h()},function(t){n.remove(),console.error(t),h()},l.apiToken)}else{var u=new Date,t=[{id:u.getTime(),task:a,comments:[],tags:[],data:[]}],d=Utils.map(t,r.punchListItemTemplate).join("");n.remove(),c.innerHTML=c.innerHTML+d}else n.remove()},k=function(t){var e=t.getAttribute("data-id"),n=i.querySelector("#"+s.punchListComment+"new"),c=t.value;if(c.length>0)if(l.commentAPICall){p();var a={text:c,user_id:l.userId,item_id:e};Utils.apiCall("POST",l.commentAPICall,a,function(t){var c=b(t),a=i.querySelector("#"+s.punchListComments+e),o=Utils.map([c],r.punchListCommentTemplate).join("");n.remove(),a.innerHTML=o+a.innerHTML,h(),v(e)},function(t){n.remove(),console.error(t),h()},l.apiToken)}else t.parentNode.innerHTML=c,v(e);else n.remove()},j=function(t){if(!o){var e=t.target.getAttribute("data-action");switch(e){case"punchlist-item-action-checked":!function(t){var e=t.getAttribute("data-id"),n=function(){};l.itemAPICall&&(n=function(){var n={punched:t.checked};Utils.apiCall("PUT",l.itemAPICall+"/"+e,n,function(e){var n=y(e);t.checked=n.punched,h()},function(e){console.error(e),t.checked=!t.checked,h()},l.apiToken)}),l.confirmCheck?f("Do you want to change task status?",n,function(){t.checked=!t.checked}):n()}(t.target);break;case"punchlist-item-action-comment":n=t.target,c=n.getAttribute("data-id"),i.querySelector("#"+s.punchListComments+c).classList.toggle("hidden");break;case"punchlist-item-action-remove":!function(t){var e=t.getAttribute("data-id"),n=i.querySelector("#"+s.punchListItem+e),c=function(){T(n)};l.itemAPICall&&(c=function(){p(),Utils.apiCall("DELETE",l.itemAPICall+"/"+e,null,function(t){h(),T(n)},function(t){console.error(t),h()},l.apiToken)}),l.confirmDeleteItem?f("Do you want to remove task?",c,null):c()}(t.target);break;case"punchlist-item-action-add":!function(){var t=[{id:"new",task:"",comments:[],tags:[],data:[]}],e=Utils.map(t,r.punchListItemTemplate).join("");i.innerHTML=i.innerHTML+e;var n=i.querySelector("#"+s.punchListItem+"new").querySelector("#"+s.punchListItemText+"new"),c=w("punch-item-text-input");c.addEventListener("blur",x,!1),n.append(c),c.focus()}();break;case"punchlist-item-comment-action-add":!function(t){var e=t.getAttribute("data-id"),n=i.querySelector("#"+s.punchListComments+e),c={id:"new",comment:"",tags:[]},a=Utils.map([c],r.punchListCommentTemplate).join("");n.innerHTML=a+n.innerHTML;var o=w("punch-comment-input-text");o.setAttribute("data-id",e),n.querySelector("#"+s.punchListCommentText+"new").append(o),o.addEventListener("blur",x,!1),o.focus()}(t.target);break;case"punchlist-item-comment-action-remove":!function(t){var e=t.getAttribute("data-id"),n=i.querySelector("#"+s.punchListComment+e);l.commentAPICall?(p(),Utils.apiCall("DELETE",l.commentAPICall+"/"+e,null,function(t){n.remove(),h(),v(e)},function(t){console.error(t),h()},l.apiToken)):(n.remove(),v(e))}(t.target)}}var n,c},x=function(t){if(!o){var e=t.target.getAttribute("id");switch(e){case"punch-item-text-input":C(t.target);break;case"punch-comment-input-text":k(t.target)}}},I=function(t){if(!o){var e=t.target.getAttribute("id");switch(e){case"punch-projects":L()}}},$=function(t){var e=t.which||t.keyCode;if(13===e){var n=t.target.getAttribute("id");switch(n){case"punch-item-text-input":t.target.removeEventListener("blur",x,!1),C(t.target);break;case"punch-comment-input-text":t.target.removeEventListener("blur",x,!1),k(t.target)}}};return u.destroy=function(){l&&(n.removeEventListener("click",j,!1),n.removeEventListener("keypress",$,!1),n.removeEventListener("change",I,!0),l=null)},u.init=function(t){if(!d)return;u.destroy(),l=Utils.extend(m,t);let e=document.querySelector(l.container);e?(function(t){var e=l.projects.map(function(t){var e=Object.assign({},t);return e.id==l.projectId?e.selected="selected":e.selected="",e});t.classList.add("punchlist-container");var n=[{title:l.title,projects:e}].map(r.punchListContainerTemplate).join("");l.width&&(t.style.width=l.width+"px"),t.innerHTML=n}(n=e),i=n.querySelector("#"+s.punchListItems),n.addEventListener("click",j,!1),n.addEventListener("keypress",$,!1),n.addEventListener("change",I,!0),c=n.querySelector("#"+s.punchListWorking),a=n.querySelector("#"+s.punchListModal),L()):(console.error('[PunchList][init] Main container not found. Selector: "'+l.container+'"'),u.destroy())},u.drawItems=function(t){if(t.length>0){var e=t.map(r.punchListItemTemplate).join("");i.innerHTML=e}else i.innerHTML=""},u}(o),void 0===(a="function"==typeof c?c.call(e,n,e,t):c)||(t.exports=a)}).call(this,n(2))},function(t,e){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(t){"object"==typeof window&&(n=window)}t.exports=n},function(t,e){!function(){var t=window.DomReady={},e=navigator.userAgent.toLowerCase(),n={version:(e.match(/.+(?:rv|it|ra|ie)[\/: ]([\d.]+)/)||[])[1],safari:/webkit/.test(e),opera:/opera/.test(e),msie:/msie/.test(e)&&!/opera/.test(e),mozilla:/mozilla/.test(e)&&!/(compatible|webkit)/.test(e)},i=!1,c=!1,a=[];function o(){if(!c&&(c=!0,a)){for(var t=0;t<a.length;t++)a[t].call(window,[]);a=[]}}function s(){if(!i){var t,e,a;if(i=!0,document.addEventListener&&!n.opera&&document.addEventListener("DOMContentLoaded",o,!1),n.msie&&window==top&&function(){if(!c){try{document.documentElement.doScroll("left")}catch(t){return void setTimeout(arguments.callee,0)}o()}}(),n.opera&&document.addEventListener("DOMContentLoaded",function(){if(!c){for(var t=0;t<document.styleSheets.length;t++)if(document.styleSheets[t].disabled)return void setTimeout(arguments.callee,0);o()}},!1),n.safari)!function(){if(!c)if("loaded"==document.readyState||"complete"==document.readyState){if(void 0===t){for(var e=document.getElementsByTagName("link"),n=0;n<e.length;n++)"stylesheet"==e[n].getAttribute("rel")&&t++;var i=document.getElementsByTagName("style");t+=i.length}document.styleSheets.length==t?o():setTimeout(arguments.callee,0)}else setTimeout(arguments.callee,0)}();e=o,a=window.onload,"function"!=typeof window.onload?window.onload=e:window.onload=function(){a&&a(),e()}}}t.ready=function(t,e){s(),c?t.call(window,[]):a.push(function(){return t.call(window,[])})},s()}();window.Utils={map:function(t,e){var n;if(Array.isArray(t))n=t.map(e);else if("object"==typeof t&&t)for(var i in n=[],t)n.push(e(t[i],i,t));return n},mapWithIndex:function(t,e,n){var i;return"object"==typeof e&&e&&(i=[]).push(n(e,t,e)),i},extend:function(){var t={},e=!1,n=0,i=arguments.length;"[object Boolean]"===Object.prototype.toString.call(arguments[0])&&(e=arguments[0],n++);for(var c=function(n){for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e&&"[object Object]"===Object.prototype.toString.call(n[i])?t[i]=extend(!0,t[i],n[i]):t[i]=n[i])};n<i;n++)c(arguments[n]);return t},apiCall:function(t,e,n,i,c,a){const o=new Headers;var s,r;o.append("Content-Type","application/json"),o.append("Authorization","Bearer "+a),o.append("Accept","application/json, text-plain, */*"),o.append("X-Requested-With","XMLHttpRequest");var l={method:t,mode:"cors",cache:"no-cache",credentials:"same-origin",headers:o,redirect:"follow",referrer:"no-referrer"};return"GET"!=t&&n&&(l.body=JSON.stringify(n)),fetch(e,l).then(t=>(s=t.status,r=t.ok,t.json())).then(t=>{if(!r){var e=new Error("Punch List Error");throw e.code=s,e.json=t,e}i(t)}).catch(t=>{if(!t.json)throw t;information=t.json,c(information)})}}}]);